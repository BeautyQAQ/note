### 红黑树

- 《算法导论》中的红黑树:
    - 每个节点或是红色的, 或者是黑色的
    - 根节点是黑色的
    - 每一个叶子节点(最后的空节点)是黑色的
    - 如果一个节点是红色的, 那么他的孩子节点都是黑色的
    - 从任意一个节点到叶子节点, 经过的黑色节点是一样的


**红黑树与2-3树是等价的**

2-3树:
- 满足二分搜索树的基本性质
- 节点可以存放一个元素(有两个孩子--2节点)或者两个元素(有三个孩子--3节点)
- 2-3是一棵绝对平衡的树(从根节点到叶子节点经过的节点数量是相同的)


2-3树的插入:
![插入2-节点](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220122151023.png)
![插入3-节点](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220122151054.png)
![插入3-节点1](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220122151123.png)
![插入3-节点2](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220122151144.png)
![插入3-节点3](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220122151210.png)
![插入3-节点4](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220122151233.png)


红黑树与2-3树的等价性:
![红黑树与2-3树的等价性1](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220122152252.png)
![红黑树与2-3树的等价性2](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220122152438.png)

红黑树最大高度: 2logn, 时间复杂度(增删改查都是): O(logn)  

- 向红黑树中添加元素:
    - 2-3树种添加一个新元素
    - 或者添加一进2-节点, 形成一个3-节点
    - 或者添加一进3-节点, 暂时形成一个4-节点
    - 永远添加红色节点
![左旋转1](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220123150348.png)
![左旋转2](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220123150412.png)

等价于3-节点添加元素:
![添加元素1](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220123150510.png)
![添加元素2](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220123150553.png)
![添加元素3](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220123150610.png)

右旋转:
![右旋转1](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220201192736.png)
![右旋转2](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220201192834.png)
![右旋转3](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220201193158.png)
![右旋转4](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220201193809.png)

红黑树添加元素归纳: 
![红黑树添加元素](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220201201410.png)

- 红黑树的性能总结:
  - 对于完全随机的数据, 普通的二分搜索树很好用
  - 缺点: 极端情况退化成链表(或者高度不平衡)
  - 对于查询较多的情况, AVL树很好用
  - 红黑树牺牲了平衡性(2logn的高度)
  - 红黑树统计性能更优(综合增删改查所有的操作)

  ![伸展树](https://study-note-huang.oss-cn-beijing.aliyuncs.com/img/20220201204943.png)

--------------补充:--------------------  
对于红黑树，任何不平衡都会在三次旋转内解决？  
可能很多时候看面经，会看到关于红黑树的这样一条性质：  
对于红黑树，任何不平衡都会在三次旋转内解决。但是，看过这里所介绍的红黑树，所实现的红黑树是没有这个性质的。但是，更优化的红黑树实现可以有这个性质！  


在这里，关键在于，这个红黑树（包括《算法4》所介绍的红黑树），是一种特殊的红黑树——左倾红黑树。但是红黑树本身并不需要“左倾”性质。也就是说，这里实现的左倾红黑树一定是红黑树；但是红黑树不一定全是左倾红黑树。换句话说，这里的代码为了维护“左倾”这个性质，做了额外的事情，消耗了性能，使得这个红黑树的实现，没有“任何不平衡都可以在三次旋转内解决”这么好的性能优势。  

前面提到的红黑树的五个性质。只要满足着五个性质，就是红黑树！这五个性质是红黑树的标准定义。  

这五个性质再罗列一下，是：

- 所有节点非红即黑；

- 根节点为黑；

- 最后的NULL节点为黑；

- 红节点的孩子一定为黑；

- 黑平衡

仔细观察这五个性质，大家就会发现，红黑树的标准定义中没有规定红节点一定左倾：）  

换句话说，以下的两种形状，是满足红黑树的性质的！（其中B代表黑节点；R代表红节点）：

```
   B            
 /   \          
B     R

   B
 /   \
R     R
```
但是，由于在这个实现中，以上两种情况并不满足“左倾”的性质，就需要额外的操作，将这两种情况转换成“左倾”的样子。这也就是这里说的，红黑树有更优的实现。当放宽限制，让红黑树也可以包含上面两种样子的时候，需要的旋转调整将减少，并且有对于任何不平衡，三次旋转即可解决！  

印象里，《算法导论》中红黑树的实现，是满足这个性质的。有兴趣的，不妨找来《算法导论》，好好研究一下：）  

那么如果以上的两个样子也符合红黑树的定义，意味着什么呢？  

我们可以仔细观察一下其中的第二种样子：

```
   B
 /   \
R     R
```
根据我们课程中介绍的红黑树和2-3树的关系，这其实意味着红黑树不仅仅是和2-3树等价的，还和2-4树等价（包含2-node，3-node，4-node）。但是，对于其中的4-node，只能用以上的样子表示，而不能使用以下两种形状：

```
    B    B   
   /      \
  R        R
 /          \
R            R
```
这是因为以上两种形状，他们破坏了红黑树的性质4！  

在这里，再回顾一下红黑树的五个性质！

- 所有节点非红即黑；

- 根节点为黑；

- 最后的NULL节点为黑；

- 红节点的孩子一定为黑；

- 黑平衡

有时候，其中前三个性质，都是非常记忆的很朴素的定义。对于性质4，又称为“红色性质”，因为它是和红色节点相关的；相应的，性质5，我们有时候又称为“黑色性质”，因为它是和黑色节点相关的。    

同时，通过这个角度，用2-4树去理解《算法导论》中红黑树的实现，或许更容易。（但是不知道为什么，印象里《算法导论》中完全没有提及红黑树和2-3树，2-4树的关系！）